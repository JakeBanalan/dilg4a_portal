<template>
    <div class="row">

        <div class="col-md-6 grid-margin stretch-card">
            <div class="card">
                <div class="card-body">
                    <p class="card-title">
                        <img src="../../../../assets/images/logo.png" alt="DILG Logo"
                            style="width: 50px; height: 50px; margin-right: 10px;">
                        IP Phone Telephony Directory
                    </p>
                    <div class="row">
                        <div class="col-6">
                            <div class="table-responsive table-wrapper">
                                <table id="example" class="display expandable-table table-striped" style="width:100%">
                                    <thead>
                                        <tr>
                                            <th>DIVISION/SECTION</th>
                                            <th>DIRECTORY</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                            <td><span style="font-weight: bold; font-size: 12pt;">RD's Secretary</span>
                                            </td>
                                            <td><span style="font-weight: bold; font-size: 12pt;">7401</span></td>
                                        </tr>
                                        <tr>
                                            <td><span style="font-weight: bold; font-size: 12pt;">ARD's Secretary</span>
                                            </td>
                                            <td><span style="font-weight: bold; font-size: 12pt;">7402</span></td>
                                        </tr>
                                        <tr>
                                            <td><span style="font-weight: bold; font-size: 12pt;">ORD LEGAL</span>
                                            </td>
                                            <td><span style="font-weight: bold; font-size: 12pt;">7430</span></td>
                                        </tr>
                                        <tr>
                                            <td><span style="font-weight: bold; font-size: 12pt;">ORD RICTU</span>
                                            </td>
                                            <td><span style="font-weight: bold; font-size: 12pt;">7406</span></td>
                                        </tr>
                                        <tr>
                                            <td><span style="font-weight: bold; font-size: 12pt;">FAD CHIEF</span>
                                            </td>
                                            <td><span style="font-weight: bold; font-size: 12pt;">7408</span></td>
                                        </tr>
                                        <tr>
                                            <td><span style="font-weight: bold; font-size: 12pt;">FAD-HR</span>
                                            </td>
                                            <td><span style="font-weight: bold; font-size: 12pt;">7403</span></td>
                                        </tr>
                                        <tr>
                                            <td><span style="font-weight: bold; font-size: 12pt;">FAD-RECORDS</span>
                                            </td>
                                            <td><span style="font-weight: bold; font-size: 12pt;">7407</span></td>
                                        </tr>
                                        <tr>
                                            <td><span style="font-weight: bold; font-size: 12pt;">FAD-FINANCE</span>
                                            </td>
                                            <td><span style="font-weight: bold; font-size: 12pt;">7409</span></td>
                                        </tr>
                                        <tr>
                                            <td><span style="font-weight: bold; font-size: 12pt;">FAD-GSS</span>
                                            </td>
                                            <td><span style="font-weight: bold; font-size: 12pt;">7410</span></td>
                                        </tr>
                                        <tr>
                                            <td><span style="font-weight: bold; font-size: 12pt;">LGCDD-CHIEF</span>
                                            </td>
                                            <td><span style="font-weight: bold; font-size: 12pt;">7440</span></td>
                                        </tr>
                                        <tr>
                                            <td><span style="font-weight: bold; font-size: 12pt;">LGCDD</span>
                                            </td>
                                            <td><span style="font-weight: bold; font-size: 12pt;">7404</span></td>
                                        </tr>
                                        <tr>
                                            <td><span style="font-weight: bold; font-size: 12pt;">LGMED CHIEF</span>
                                            </td>
                                            <td><span style="font-weight: bold; font-size: 12pt;">7420</span></td>
                                        </tr>
                                        <tr>
                                            <td><span style="font-weight: bold; font-size: 12pt;">LGMED</span>
                                            </td>
                                            <td><span style="font-weight: bold; font-size: 12pt;">7405</span></td>
                                        </tr>
                                        <tr>
                                            <td><span style="font-weight: bold; font-size: 12pt;">GUARD</span>
                                            </td>
                                            <td><span style="font-weight: bold; font-size: 12pt;">7400</span></td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        <div class="col-6">
                            <div class="table-responsive table-wrapper">
                                <table id="example" class="display expandable-table table-striped" style="width:100%">
                                    <thead>
                                        <tr>
                                            <th>DILG PROVINCIAL/HUC OFFICES</th>
                                            <th>DIRECTORY</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                            <td><span style="font-weight: bold; font-size: 12pt;">BATANGAS
                                                    (OIC-PM)</span>
                                            </td>
                                            <td><span style="font-weight: bold; font-size: 12pt;">7411</span></td>
                                        </tr>
                                        <tr>
                                            <td><span style="font-weight: bold; font-size: 12pt;">BATANGAS</span>
                                            </td>
                                            <td><span style="font-weight: bold; font-size: 12pt;">7412</span></td>
                                        </tr>
                                        <tr>
                                            <td><span style="font-weight: bold; font-size: 12pt;">CAVITE (PD)</span>
                                            </td>
                                            <td><span style="font-weight: bold; font-size: 12pt;">7422</span></td>
                                        </tr>
                                        <tr>
                                            <td><span style="font-weight: bold; font-size: 12pt;">CAVITE</span>
                                            </td>
                                            <td><span style="font-weight: bold; font-size: 12pt;">7421</span></td>
                                        </tr>
                                        <tr>
                                            <td><span style="font-weight: bold; font-size: 12pt;">LAGUNA (PM)</span>
                                            </td>
                                            <td><span style="font-weight: bold; font-size: 12pt;">7432</span></td>
                                        </tr>
                                        <tr>
                                            <td><span style="font-weight: bold; font-size: 12pt;">LAGUNA (FAS)</span>
                                            </td>
                                            <td><span style="font-weight: bold; font-size: 12pt;">7431</span></td>
                                        </tr>
                                        <tr>
                                            <td><span style="font-weight: bold; font-size: 12pt;">QUEZON (PD)</span>
                                            </td>
                                            <td><span style="font-weight: bold; font-size: 12pt;">7442</span></td>
                                        </tr>
                                        <tr>
                                            <td><span style="font-weight: bold; font-size: 12pt;">QUEZON</span>
                                            </td>
                                            <td><span style="font-weight: bold; font-size: 12pt;">7441</span></td>
                                        </tr>
                                        <tr>
                                            <td><span style="font-weight: bold; font-size: 12pt;">RIZAL (PD)</span>
                                            </td>
                                            <td><span style="font-weight: bold; font-size: 12pt;">7451</span></td>
                                        </tr>
                                        <tr>
                                            <td><span style="font-weight: bold; font-size: 12pt;">RIZAL</span>
                                            </td>
                                            <td><span style="font-weight: bold; font-size: 12pt;">7452</span></td>
                                        </tr>
                                        <tr>
                                            <td><span style="font-weight: bold; font-size: 12pt;">LUCENA CITY</span>
                                            </td>
                                            <td><span style="font-weight: bold; font-size: 12pt;">7415</span></td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-md-6 grid-margin stretch-card">
            <div class="card">
                <div class="card-body">
                    <p class="card-title">
                        <img src="../../../../assets/images/logo.png" alt="DILG Logo"
                            style="width: 50px; height: 50px; margin-right: 10px;">
                        Birthday Celebrants
                    </p>
                    <div class="row">
                        <div class="col-12">
                            <div class="table-responsive table-wrapper">
                                <table id="example" class="display expandable-table" style="width:100%">
                                    <thead>
                                        <tr>
                                            <th style="text-align: left;">Name</th>
                                            <th  style="text-align: left;">Birthdate</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr v-for="user in users" :key="user.id">
                                            <td @click="launchConfetti(user.name)" style="cursor: pointer; text-align: left;">
                                                <font-awesome-icon :icon="['fas', 'gift']" />&nbsp; {{ user.name }}
                                            </td>
                                            <td  style="text-align: left;">{{ user.birthdate }}</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <canvas id="confettiCanvas"
        style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none;"></canvas>
</template>

<script>
import { FontAwesomeIcon } from '@fortawesome/vue-fontawesome';
import { library } from '@fortawesome/fontawesome-svg-core';
import { faGift } from '@fortawesome/free-solid-svg-icons';
import confetti from 'canvas-confetti';

library.add(faGift);

export default {
    name: 'BirthdayTable',
    components: { FontAwesomeIcon },
    data() {
        return {
            users: []
        };
    },
    mounted() {
        this.fetchUsers();
    },
    methods: {
        fetchUsers() {
            axios.get('/api/fetchAllUsers')
                .then(response => {
                    this.users = response.data.filter(user => {
                        const birthdate = new Date(user.birthdate);
                        const currentMonth = new Date().getMonth();
                        return birthdate.getMonth() === currentMonth;
                    });
                    this.users.forEach(user => {
                        const birthdate = new Date(user.birthdate);
                        user.age = Math.floor((new Date() - birthdate) / 31536000000);
                    });
                })
                .catch(error => {
                    console.error(error);
                });
        },
        launchConfetti(name) {
            confetti({
                particleCount: 100,
                spread: 70,
                origin: { y: 0.6 }
            });

        }
    }
};
</script>

<style>
.table-wrapper {
    max-height: 300px;
    overflow-y: auto;
}
</style>
